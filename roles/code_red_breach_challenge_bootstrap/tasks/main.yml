---
- name: Create kube config
  ansible.builtin.shell: |
    oc login -t {{ openshift_cluster_admin_token }} -{{ openshift_api_url }} --insecure-skip-tls-verify
  delegate_to: bastion

- name: Setup Vault
  ansible.builtin.include_tasks:
    file: ./setup_vault.yml

- name: Setup External Secrets Operator
  ansible.builtin.include_tasks:
    file: ./setup_external_secrets.yml

- name: Setup Quay
  ansible.builtin.include_tasks:
    file: ./setup_quay.yml

- name: Setup External Secrets Operator
  ansible.builtin.include_tasks:
    file: ./setup_external_secret_entries.yml

- name: Setup Tekton Chains
  ansible.builtin.include_tasks:
    file: ./setup_tekton_chains.yml

- name: Setup CycloneDX Repository
  ansible.builtin.include_tasks:
    file: ./setup_cyclonedx_repo_server.yml

- name: Setup remote app
  ansible.builtin.include_tasks:
    file: ./setup_remote_app.yml
  delegate_to: bastion

- name: Setup job runner
  ansible.builtin.include_tasks:
    file: ./setup_job_runner.yml